<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Teste Chat</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
    <script>
      var socket = null;
      
      $(document).ready(function() {
        $('#div_texto').css('display', 'none');
        $('#div_conectar').css('display', 'block');
        
        $('#but_ok').live('click', function() {
          socket.emit('chat', { msg: $('#texto').val(),
                                dataHora: formatHour(new Date()),
                                autor: $('#nome').val() });
        });
        
        $('#but_conectar').live('click', function() {
          $('#but_conectar').attr('disabled', 'disabled');
          $('#but_conectar').attr('value', 'Conectando...');
          socket = io.connect(window.location.href);
          socket.on('chat', function (data) {
            $('#div_conectar').css('display', 'none');
            $('#div_texto').css('display', 'block');
            
            console.log(data);
            $('#chat').append('<br/>[');
            $('#chat').append(data.dataHora);
            $('#chat').append('] ');
            $('#chat').append(data.autor);
            $('#chat').append(': ');
            $('#chat').append(data.msg);
          });
        });
      });
      
      function formatHour(dataHora) {
        var that = new Date(dataHora);
        var temp = '';
        
        if(that.getHours() < 10)
          temp += '0';
            
        temp += that.getHours() + ':';
        
        if(that.getMinutes() < 10)
          temp += '0';
        
        temp += that.getMinutes();
            
        return temp;
      }
    </script>
  </head>
  <body>
    <div id="chat" style="width: 400px; height: 300px; overflow-y: scroll; overflow-x: auto;">
    </div>
    <div id="div_conectar">
      Nome:
      <input type="text" id="nome" style="width: 300px;" />
      <input type="button" id="but_conectar" value="  Conectar  " />
    </div>
    <div id="div_texto">
      <input type="text" id="texto" style="width: 300px;" />
      <input type="button" id="but_ok" value="  OK  " />
    </div>
  </body>
</html>